---
const pathname = new URL(Astro.request.url).pathname;
const currentPath = pathname.slice(1); // remove the first "/"
let content = "";
let body = "";
let title = "";
const regex = /(^.*?(?=\())\(([^\)]+)\)/;
var abbreviations = [];

abbreviations['3G']     = 'third generation';
abbreviations['AC']     = 'additional consent';
abbreviations['ACH']    = 'automated clearing house';
abbreviations['AI']     = 'artificial intelligence';
abbreviations['a.k.a.'] = 'also known as';
abbreviations['ALX']    = 'AppLovin Exchange';
abbreviations['API']    = 'application programming interface';
abbreviations['Apr.']   = 'April';
abbreviations['APS']    = 'Amazon Publisher Services';
abbreviations['ARPDAU'] = 'Average Revenue Per Daily Active User';
abbreviations['ARPPU']  = 'Average Revenue Per Paying User';
abbreviations['ASIN']   = 'Amazon Standard Identification Number';
abbreviations['ATP']    = 'Ad Technology Provider';
abbreviations['ATS']    = 'App Transport Security';
abbreviations['ATT']    = 'App Tracking Transparency';
abbreviations['CAC']    = 'customer acquisition cost';
abbreviations['CCPA']   = 'California Consumer Privacy Act';
abbreviations['CI/CD']  = 'continuous integration / continuous delivery';
abbreviations['CMP']    = 'Consent Management Platform';
abbreviations['COPPA']  = 'Childrenâ€™s Online Privacy Protection Act';
abbreviations['CPA']    = 'cost per action';
abbreviations['CPC']    = 'cost per click';
abbreviations['CPE']    = 'cost per engagement';
abbreviations['CPI']    = 'cost per install';
abbreviations['CPM']    = 'cost per mille';
abbreviations['CPP']    = 'cost per point';
abbreviations['CSV']    = 'comma-separated values';
abbreviations['CTA']    = 'call to action';
abbreviations['CTR']    = 'click-through rate';
abbreviations['CTV']    = 'Connected Television';
abbreviations['DAU']    = 'daily active users';
abbreviations['DAV']    = 'daily active viewers';
abbreviations['Dec.']   = 'December';
abbreviations['DMA']    = 'Designated Market Area';
abbreviations['DNT']    = 'do not track';
abbreviations['dp']     = 'density-independent pixels';
abbreviations['DPA']    = 'Data Processing Agreement';
abbreviations['DSP']    = 'demand-side platform';
abbreviations['DT']     = 'Digital Turbine';
abbreviations['DV360']  = 'Display and Video 360';
abbreviations['e2e']    = 'end-to-end';
abbreviations['eCPM']   = 'effective cost per mille';
abbreviations['EDGE']   = 'Enhanced Data rates for G.S.M. Evolution';
abbreviations['EEA']    = 'European Economic Area';
abbreviations['FAST']   = 'free, ad-supported, streaming television';
abbreviations['FAQ']    = 'frequently asked questions';
abbreviations['FAQs']   = 'frequently asked questions';
abbreviations['Feb.']   = 'February';
abbreviations['FX']     = 'foreign transaction';
abbreviations['GAID']   = 'Google Advertiser Identity';
abbreviations['GDPR']   = 'General Data Protection Regulation';
abbreviations['GIF']    = 'Graphics Interchange Format';
abbreviations['GVL']    = 'Global Vendor List';
abbreviations['HTML']   = 'Hypertext Markup Language';
abbreviations['HTTP']   = 'Hypertext Transfer Protocol';
abbreviations['HTTPS']  = 'Hypertext Transfer Protocol, Secure';
abbreviations['IAB']    = 'Interactive Advertising Bureau';
abbreviations['IABTL']  = 'Interactive Advertising Bureau Technology Laboratory';
abbreviations['IAP']    = 'in-app purchase';
abbreviations['IAPROAS']= 'in-app purchase return on spend';
abbreviations['IAS']    = 'Integral Ad Science';
abbreviations['ID']     = 'identifier';
abbreviations['IDE']    = 'integrated development environment';
abbreviations['IDFA']   = 'identifier for advertisers';
abbreviations['IDFV']   = 'identifier for vendors';
abbreviations['IFA']    = 'identifier for advertisers';
abbreviations['IMPDAU'] = 'Impressions Per Daily Active User';
abbreviations['Inc.']   = 'incorporated';
abbreviations['IO']     = 'insertion order';
abbreviations['iOS']    = 'iPhone Operating System';
abbreviations['IP']     = 'Internet Protocol';
abbreviations['IPM']    = 'installs per mille';
abbreviations['IPv4']   = 'Internet Protocol, version 4';
abbreviations['IPv6']   = 'Internet Protocol, version 6';
abbreviations['IR']     = 'Install Rate';
abbreviations['ISP']    = 'Internet Service Provider';
abbreviations['IVT']    = 'invalid traffic';
abbreviations['Jan.']   = 'January';
abbreviations['JPEG']   = 'Joint Photographic Experts Group (graphics file type)';
abbreviations['JPG']    = 'Joint Photographic Experts Group (graphics file type)';
abbreviations['JSON']   = 'JavaScript Object Notation';
abbreviations['Jul.']   = 'July';
abbreviations['KB']     = 'kilobytes';
abbreviations['Kbps']   = 'kilobits per second';
abbreviations['KPI']    = 'key performance indicator';
abbreviations['LAT']    = 'Limit Ad Tracking';
abbreviations['LDU']    = 'Limited Data Use';
abbreviations['LTE']    = 'Long-Term Evolution';
abbreviations['LTV']    = 'lifetime value';
abbreviations['MAU']    = 'monthly active users';
abbreviations['MB']     = 'megabytes';
abbreviations['MIME']   = 'Multipurpose Internet Mail Extensions';
abbreviations['MMO']    = 'massively multiplayer, online';
abbreviations['MMORPG'] = 'massively multiplayer, online, role-playing game';
abbreviations['MMP']    = 'mobile measurement partner';
abbreviations['MPX']    = 'MoPub Exchange';
abbreviations['MRAID']  = 'Mobile Rich Media Ad Interface Definitions';
abbreviations['MREC']   = 'medium rectangle';
abbreviations['ms']     = 'milliseconds';
abbreviations['MVP']    = 'minimum viable product';
abbreviations['OEM']    = 'original equipment manufacturer';
abbreviations['OM']     = 'Open Measurement';
abbreviations['OMID']   = 'Open Measurement Interface Definition';
abbreviations['OMSDK']  = 'Open Measurement Software Development Kit';
abbreviations['OOBE']   = 'out-of-the-box experience';
abbreviations['ORMMA']  = 'Open Rich Media Mobile Advertising';
abbreviations['oRTB']   = 'open real-time bidding';
abbreviations['OS']     = 'operating system';
abbreviations['OTT']    = 'over the top';
abbreviations['PDF']    = 'portable document format';
abbreviations['PMP']    = 'private marketplace';
abbreviations['PNG']    = 'Portable Network Graphic';
abbreviations['POM']    = 'Project Object Model';
abbreviations['px']     = 'pixels';
abbreviations['QA']     = 'quality assurance';
abbreviations['REST']   = 'Representational State Transfer';
abbreviations['ROAS']   = 'return on ad spend';
abbreviations['ROI']    = 'return on investment';
abbreviations['RTB']    = 'real-time bidding';
abbreviations['S2S']    = 'server-to-server';
abbreviations['SDK']    = 'software development kit';
abbreviations['Sep.']   = 'September';
abbreviations['SHA']    = 'secure hashing algorithm';
abbreviations['SK']     = 'StoreKit';
abbreviations['SKAD']   = 'StoreKit Ad';
abbreviations['SKAN']   = 'StoreKit Ad Network';
abbreviations['SPO']    = 'supply path optimization';
abbreviations['SSP']    = 'supply-side platform';
abbreviations['TC']     = 'Transparency Consent';
abbreviations['TCF']    = 'Transparency &amp; Consent Framework';
abbreviations['TV']     = 'television';
abbreviations['UA']     = 'user agent';
abbreviations['UI']     = 'user interface';
abbreviations['UK']     = 'United Kingdom';
abbreviations['UMP']    = 'User Messaging Platform';
abbreviations['UPL']    = 'Unreal Plugin Language';
abbreviations['URI']    = 'Universal Resource Identifier';
abbreviations['URL']    = 'uniform resource locator';
abbreviations['U.S.']   = 'United States of America';
abbreviations['US']     = 'United States of America';
abbreviations['USA']    = 'United States of America';
abbreviations['USD']    = 'United States dollar';
abbreviations['UTC']    = 'Coordinated Universal Time';
abbreviations['UUID']   = 'universally unique identifier';
abbreviations['VAST']   = 'Video Ad Serving Template';
abbreviations['VPAID']  = 'Video Player-Ad Interface Definition';
abbreviations['vs.']    = 'versus';
abbreviations['VTA']    = 'view-through attribution';
abbreviations['XHTML']  = 'Extensible Hypertext Markup Language';
abbreviations['XML']    = 'Extensible Markup Language';

if (Astro.slots.has("default")) {
  content = await Astro.slots.render("default");
}

const match = content.match(regex);

if (!match) {
  body = content;
  title = abbreviations[body];
} else {
  body = match[1].trim();
  title = match[2];
}

if (!body) console.log("ERROR: abbreviation missing in " + currentPath + " (" + content + ")" );
if (!title) console.log("WARNING: abbreviation explanation missing in " + currentPath + " for " + body + " (" + content + ")" );
---

{ title ? <abbr title={title}><Fragment set:html={body} /></abbr>
        : <abbr><Fragment set:html={body} /></abbr> }
