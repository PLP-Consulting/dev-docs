---
const pathname = new URL(Astro.request.url).pathname;
const currentPath = pathname.slice(1); // remove the first "/"
let content = "";
let body = "";
let title = "";
const regex = /(^.*?(?=\())\(([^\)]+)\)/;

if (Astro.slots.has("default")) {
  content = await Astro.slots.render("default");
}

const match = content.match(regex)!
if (!match) {
  console.log("ERROR: abbreviation malformed in " + currentPath + " (" + content + ")");
} else {
  body = match[1].trim()
  title = match[2]
}

if (!body) console.log("ERROR: abbreviation missing in " + currentPath);
if (!title) console.log("WARNING: abbreviation explanation missing in " + currentPath);
---

{ title ? <abbr title={title}><Fragment set:html={body} /></abbr>
        : <abbr><Fragment set:html={body} /></abbr> }
